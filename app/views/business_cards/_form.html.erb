<div class="container">
<section style="margin: 10px;">

<fieldset style="border-radius: 5px; padding: 50px; min-height:150px;">

  <% if current_user %> 


    <%= form_for @business_card,remote: true, :html => {id: "imageform"}  do |f| %>
      <% if @business_card.errors.any? %>
        <div id="error_explanation">
          <h2><%= pluralize(@business_card.errors.count, "error") %> prohibited this business_card from being saved:</h2>

          <ul>
          <% @business_card.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
          </ul>
        </div>
      <% end %> 
      <%= f.label :image %>
      <%= f.file_field :image, :html => {id: "business_card_image"} %>
      <%= f.hidden_field :imageuri   %>
        <span>
          <%= @business_card.id %>
        </span>

      <span class="glyphicon glyphicon-camera"><input type="submit" id="imageSubmit" name="commit" value="Add Business Card"></span> 
      <br>
      <% end %>
  <% else %>
    <% link_to sessions_path %>
  <% end %>
<canvas id="c" width='600' height='300'></canvas>
<br>

 <script type="text/javascript">

  var imageInput = document.getElementById("business_card_image");
  var imageform = document.getElementById("imageform");
  var dataURL = '';
  var canvas = new fabric.Canvas('c', {
    backgroundColor: "#fff"
  });
  var context = document.getElementById('c').getContext('2d'); 
  $('#business_card_image').on('change', function(e)
  {
    var img = new Image()
    img.onload = function(e)
    {
      var imgInstance = new fabric.Image(img, {
        left: 0,
        top: 0,
        angle: 0,
        opacity: 1
      });
      canvas.add(imgInstance);
    
      $("#rotateLeft").on("click", function(e){
        imgInstance.setAngle(90);
        canvas.renderAll.bind(canvas);

    })

    }

    img.src = URL.createObjectURL(e.target.files[0]);
  })

   $("#imageSubmit").on("click", function() {
    console.log("click");
      $("#business_card_imageuri").val(canvas.toDataURL('image/png', 1.0));  
   })

  </script>

<button id="rotateLeft">Rotate 90(left)</button>
<button>Rotate 90(right)</button>
<button>Grey Scale</button>
<input type="range", style="background: black;">Threshold</input>


</fieldset> 

</div>

